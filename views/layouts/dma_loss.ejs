<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Sao việt | Thất thoát theo DMA</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/plugins_2/fontawesome-free/css/all.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Tempusdominus Bbootstrap 4 -->
    <link rel="stylesheet" href="/plugins_2/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="/plugins_2/icheck-bootstrap/icheck-bootstrap.min.css">
    <!-- JQVMap -->
    <link rel="stylesheet" href="/plugins_2/jqvmap/jqvmap.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/dist/css/adminlte.min.css">

    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="/plugins_2/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="/plugins_2/daterangepicker/daterangepicker.css">
    <!-- summernote -->
    <link rel="stylesheet" href="/plugins_2/summernote/summernote-bs4.css">
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
        <!-- leafmap -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
        
        <!-- Leaflet.markercluster -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <!-- Select2 -->
    <link rel="stylesheet" href="/plugins_2/select2/css/select2.min.css">
    <link rel="stylesheet" href="/plugins_2/select2-bootstrap4-theme/select2-bootstrap4.min.css">

    <link type="text/css" rel="stylesheet" href="/stylesheets/general_style.css">
    <link type="text/css" rel="stylesheet" href="/stylesheets/style_2.css">

</head>

<body class="hold-transition layout-top-nav">
    <div class="wrapper">
        <!-- Navbar -->
        <%- include('../partials/header') %>

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper" style="padding-top: 60px;">
                <!-- Content Header (Page header) -->
                <div class="content-header">
                    <!-- <div class="container-fluid">
        <div class="row">
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-left">
                <li class="breadcrumb-item"><a href="/dashboard">SAO VIỆT</a></li>
                <li class="breadcrumb-item active">Giám sát tổng quan</li>
            </ol>          
        </div>
        </div>
      </div> -->
                </div>
                <!-- /.content-header -->

                <!-- Main content -->
                <section class="content">
                    <div class="container-fluid">
                        <!-- Main row -->
                        <div class="row mb-1 d-flex flex-wrap align-items-end">
                            <div class="col-lg-3 col-md-3 col-6">
                                <div class="form-group">
                                    <label for="">Chọn DMA:</label>
                                    <select class="form-control selectpicker" required id="filter_dma" data-live-search="true" autocomplete="off">
                                        <% for(let i=0; i < DMA.length; i++){ %>
                                            <option data-tokens="<%= DMA[i].org_name %>" org_id="<%= DMA[i].id %>" ><%= DMA[i].org_name %>
                                            </option>
                                            <%}%>
                                    </select>
                                </div>          
                            </div>
                            <div class="col-lg-2 col-md-2 col-6">
                                <div class="form-group">
                                    <label for="">Loại:</label>
                                    <select class="form-control" id="dma_data_type">
                                        <option value="hour" selected>Giờ</option>
                                        <option value="day" >Ngày</option>
                                        <option value="month" >Tháng</option>
                                    </select>
                                </div>          
                            </div>
                            <div class="col-lg-2 col-md-2 col-6">
                                <div class="form-group">
                                    <label for="">Từ ngày:</label>
                                    <input class="form-control" type="text" autocomplete="off" id="dma_time_from">
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-2 col-6">
                                <div class="form-group">
                                    <label for="">Đến ngày:</label>
                                    <input class="form-control" type="text" autocomplete="off" id="dma_time_to">
                                </div>
                            </div>
                            <div class="col-auto">
                                <button class="btn btn-primary" style="margin-bottom: 16px" onclick="init_dma_data()"> <i class="fa fa-search"
                                        aria-hidden="true"></i> Tìm kiếm</button>
                            </div>
                        </div>

                        <div class="row">
                            <section class="col-lg-8 col-12" style="min-height: calc(100vh - 185px); overflow: auto;">
                                <div class="card" style="min-height:  calc(100vh - 200px); overflow: auto;">
                                    <div class="card-body">
                                        <table id="table_dma_loss_data" class="table table-bordered table-striped" style="width:100%">
                                            <thead style="background-color: #a8dbf0;">
                                                <th class="border_th_d" style="min-width: 7%">STT</th>
                                                <th class="border_th_d" style="min-width: 16%">Thời gian</th>
                                                <th class="border_th_d">Tổng vào</th>
                                                <th class="border_th_d">Tổng ra</th>
                                                <th class="border_th_d">Thất thoát</th>
                                                <th class="border_th_d">Phần trăm</th>

                                            </thead>
                                            <tbody id="body_table_dma_loss_data">

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </section>
                            <section class="col-lg-4 col-12" style="display: flex; flex-direction: column; height: calc(100vh - 185px);">
                                <div class="card" style="flex: 1; overflow: auto;">
                                    <div id="dma_loss_data_chart" style="width: 100%; height: 100%;"></div>
                                </div>
                                <div class="card" style="flex: 1; overflow: auto;">
                                    <div id="dma_loss_map" style="width: auto; height: 100%;"></div>
                                </div>
                            </section>

                            <!-- right col -->
                        </div>
                        <!-- /.row (main row) -->
                    </div><!-- /.container-fluid -->
                </section>
                <!-- /.content -->
            </div>
            <div id="loading-overlay" style="display: none;">
                <div class="spinner-border text-primary" role="status"></div>
                <span>Đang tải dữ liệu...</span>
            </div>
            <div id="notification" class="text-center"></div>

            <!-- Popup cảnh báo -->
            <div id="alert-container" style=" font-size: small;"></div>
    </div>
    <!-- ./wrapper -->
    <!-- jQuery -->
    <!-- <script src="/plugins_2/jquery/jquery.min.js"></script> -->
    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <!-- jQuery UI 1.11.4 -->
    <script src="/plugins_2/jquery-ui/jquery-ui.min.js"></script>
    <!-- amchartjs -->
    <script type="text/javascript" src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script type="text/javascript" src="https://www.amcharts.com/lib/3/serial.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>


    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->

    <script>
        $.widget.bridge('uibutton', $.ui.button)
    </script>
    <!-- Bootstrap 4 -->
    <script src="/plugins_2/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Select2 -->
    <script src="/plugins_2/select2/js/select2.full.min.js"></script>

    <!-- ChartJS -->
    <script src="/plugins_2/chart.js/Chart.min.js"></script>
    <!-- Sparkline -->
    <script src="/plugins_2/sparklines/sparkline.js"></script>
    <!-- JQVMap -->
    <script src="/plugins_2/jqvmap/jquery.vmap.min.js"></script>
    <script src="/plugins_2/jqvmap/maps/jquery.vmap.usa.js"></script>
    <!-- jQuery Knob Chart -->
    <script src="/plugins_2/jquery-knob/jquery.knob.min.js"></script>
    <!-- daterangepicker -->
    <script src="/plugins_2/moment/moment.min.js"></script>
    <script src="/plugins_2/daterangepicker/daterangepicker.js"></script>
    <!-- Tempusdominus Bootstrap 4 -->
    <script src="/plugins_2/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
    <!-- Summernote -->
    <script src="/plugins_2/summernote/summernote-bs4.min.js"></script>
    <!-- overlayScrollbars -->
    <script src="/plugins_2/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <!-- AdminLTE App -->
    <script src="/dist/js/adminlte.js"></script>
    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
    <script src="/dist/js/pages/dashboard.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="/dist/js/demo.js"></script>
    <!-- Leaflet.markercluster -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <script src="/javascripts/SmoothWheelZoom.js"></script>
    <link rel="stylesheet" href="/stylesheets/Control.FullScreen.css" />
    <script src="/javascripts/Control.FullScreen.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <!-- DataTables -->

    <!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>
<script src="//cdn.rawgit.com/ashl1/datatables-rowsgroup/v1.0.0/dataTables.rowsGroup.js"></script> -->

    <!-- DataTable -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>
    <script src="//cdn.rawgit.com/ashl1/datatables-rowsgroup/v1.0.0/dataTables.rowsGroup.js"></script>
    <!-- momentjs and daterangepicker -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

    <!-- (Optional) Latest compiled and minified JavaScript translation files -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-*.min.js"></script>

    <!-- bootsrap-select -->
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
        <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        var user_id = <% - user_id %>

            $(function () {
                $('.selectpicker').selectpicker();
            });
        function showLoading() {
            document.getElementById("loading-overlay").style.display = "flex";
        }

        function hideLoading() {
            document.getElementById("loading-overlay").style.display = "none";
        }
        $('.select2bs4').select2({
            theme: 'bootstrap4',
            closeOnSelect: false,
            tags: true

        })

        $(".select2bs4").on("select2:select", function (evt) {
            var element = evt.params.data.element;
            var $element = $(element);

            $element.detach();
            $(this).append($element);
            $(this).trigger("change");
        });

        function show_notification(message, type) {
            var notification = $("#notification");
            notification.text(message).removeClass("error success").addClass(type);
            notification.css("top", "20px").fadeIn();

            // Ẩn sau 3 giây
            setTimeout(function () {
                notification.fadeOut(function () {
                    notification.css("top", "-50px");
                });
            }, 5000);
        }
    </script>
    <script src="/javascripts/general.js"></script>
    <script src="/javascripts/dma_loss.js"></script>

</body>

</html>